<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器 | 欢乐时光</title>
    <meta name="description" content="full stack developer">
    <link rel="icon" href="/doc/gong.ico">
    
    <link rel="preload" href="/doc/assets/css/0.styles.4e84cc94.css" as="style"><link rel="preload" href="/doc/assets/js/app.914d0180.js" as="script"><link rel="preload" href="/doc/assets/js/2.1cb9a3c0.js" as="script"><link rel="preload" href="/doc/assets/js/4.69046a5f.js" as="script"><link rel="prefetch" href="/doc/assets/js/10.697aa1d8.js"><link rel="prefetch" href="/doc/assets/js/11.62e61c9b.js"><link rel="prefetch" href="/doc/assets/js/12.1cb7e593.js"><link rel="prefetch" href="/doc/assets/js/13.8c126d0e.js"><link rel="prefetch" href="/doc/assets/js/14.80d5c1f0.js"><link rel="prefetch" href="/doc/assets/js/15.23828660.js"><link rel="prefetch" href="/doc/assets/js/16.af49f84e.js"><link rel="prefetch" href="/doc/assets/js/17.489866b7.js"><link rel="prefetch" href="/doc/assets/js/18.603d27f6.js"><link rel="prefetch" href="/doc/assets/js/19.5ada21ca.js"><link rel="prefetch" href="/doc/assets/js/20.4970fd79.js"><link rel="prefetch" href="/doc/assets/js/21.4d5b0e7a.js"><link rel="prefetch" href="/doc/assets/js/22.a8ddad26.js"><link rel="prefetch" href="/doc/assets/js/23.ae9e935e.js"><link rel="prefetch" href="/doc/assets/js/24.fec5c378.js"><link rel="prefetch" href="/doc/assets/js/25.61b1e4ae.js"><link rel="prefetch" href="/doc/assets/js/26.93a286c9.js"><link rel="prefetch" href="/doc/assets/js/27.a77aeba8.js"><link rel="prefetch" href="/doc/assets/js/28.6ef6aa39.js"><link rel="prefetch" href="/doc/assets/js/29.db1189f6.js"><link rel="prefetch" href="/doc/assets/js/3.08d9d62c.js"><link rel="prefetch" href="/doc/assets/js/30.a2809d34.js"><link rel="prefetch" href="/doc/assets/js/31.d55975ef.js"><link rel="prefetch" href="/doc/assets/js/32.1410a616.js"><link rel="prefetch" href="/doc/assets/js/33.ec3232db.js"><link rel="prefetch" href="/doc/assets/js/34.71e8287d.js"><link rel="prefetch" href="/doc/assets/js/35.d9b3a4a1.js"><link rel="prefetch" href="/doc/assets/js/36.48a64abc.js"><link rel="prefetch" href="/doc/assets/js/37.065434a8.js"><link rel="prefetch" href="/doc/assets/js/38.f8f21f24.js"><link rel="prefetch" href="/doc/assets/js/39.7f654d96.js"><link rel="prefetch" href="/doc/assets/js/40.80b3ea56.js"><link rel="prefetch" href="/doc/assets/js/41.e01bac36.js"><link rel="prefetch" href="/doc/assets/js/5.1160325b.js"><link rel="prefetch" href="/doc/assets/js/6.8af3c272.js"><link rel="prefetch" href="/doc/assets/js/7.da2da2c0.js"><link rel="prefetch" href="/doc/assets/js/8.8cea9a04.js"><link rel="prefetch" href="/doc/assets/js/9.5f0f1f3f.js">
    <link rel="stylesheet" href="/doc/assets/css/0.styles.4e84cc94.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/doc/" class="home-link router-link-active"><!----> <span class="site-name">欢乐时光</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/doc/ppt/" class="nav-link">爬虫</a></div><div class="nav-item"><a href="/doc/node/" class="nav-link">Node</a></div><div class="nav-item"><a href="/doc/handle/" class="nav-link">手写系列</a></div><div class="nav-item"><a href="/doc/js/" class="nav-link">JS归纳</a></div><div class="nav-item"><a href="/doc/CI_CD/" class="nav-link">CI/CD</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="More" class="dropdown-title"><span class="title">More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><!----> <a href="/doc/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/doc/other/" class="nav-link router-link-active">Other</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/gzwgq222" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/doc/ppt/" class="nav-link">爬虫</a></div><div class="nav-item"><a href="/doc/node/" class="nav-link">Node</a></div><div class="nav-item"><a href="/doc/handle/" class="nav-link">手写系列</a></div><div class="nav-item"><a href="/doc/js/" class="nav-link">JS归纳</a></div><div class="nav-item"><a href="/doc/CI_CD/" class="nav-link">CI/CD</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="More" class="dropdown-title"><span class="title">More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><!----> <a href="/doc/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/doc/other/" class="nav-link router-link-active">Other</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/gzwgq222" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/doc/other/web.html" class="active sidebar-link">浏览器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/other/web.html#url-到页面展示的过程" class="sidebar-link">url 到页面展示的过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/other/web.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/doc/other/web.html#_1、dns-解析" class="sidebar-link">1、DNS 解析</a></li><li class="sidebar-sub-header"><a href="/doc/other/web.html#_2、tcp链接" class="sidebar-link">2、TCP链接</a></li><li class="sidebar-sub-header"><a href="/doc/other/web.html#_3、发送-http-请求" class="sidebar-link">3、发送 HTTP 请求</a></li><li class="sidebar-sub-header"><a href="/doc/other/web.html#_4、服务器处理请求并返回请求报文" class="sidebar-link">4、服务器处理请求并返回请求报文</a></li><li class="sidebar-sub-header"><a href="/doc/other/web.html#_5、浏览器解析渲染页面" class="sidebar-link">5、浏览器解析渲染页面</a></li><li class="sidebar-sub-header"><a href="/doc/other/web.html#_6、断开链接" class="sidebar-link">6、断开链接</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="浏览器"><a href="#浏览器" class="header-anchor">#</a> 浏览器</h1> <h2 id="url-到页面展示的过程"><a href="#url-到页面展示的过程" class="header-anchor">#</a> url 到页面展示的过程</h2> <h3 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h3> <p>从浏览器输入 url 回车到页面展示内容到底发生了些什么？大致过程如下图示:
<img src="/doc/assets/img/web.ea90f6db.png" alt="流程">
总体来说分为以下几个过程</p> <ul><li>DNS 解析（域名解析为 ip）</li> <li>TCP 链接（三次握手）</li> <li>发送 HTTP 请求</li> <li>服务器处理请求并返回请求报文</li> <li>浏览器解析渲染页面</li> <li>断开 TCP 链接（四次挥手）</li></ul> <p>带着疑问来了解这个知识点会更加的牢固和有拓展性。比如：<br>
1 析 DNS 分为哪几个阶段？<br>
2 每次解析的 ip 都一样吗？<br>
3 每次都会解析吗？<br>
4 请求报文由什么组成？<br>
5 三次握手、四次挥手分别是什么？<br>
6 二次握手、四次握手不可以吗？为什么是三次握手？</p> <h3 id="_1、dns-解析"><a href="#_1、dns-解析" class="header-anchor">#</a> 1、DNS 解析</h3> <p>输入访问网址后，需要经过域名解析，因为浏览器并不能直接的根据域名找到对应的服务器，而是通过 ip 地址进行访问。如果访问的地址直接是 ip 地址的话则不需要 DNS 解析。</p> <ol><li>IP 地址<br> <code>IP 地址是指互联网协议地址，是 IP Address 的缩写。IP 地址是 IP 协议提供的一种统一的地址格式，它为互联网上的每一个网络和每一台主机分配一个逻辑地址，以此来屏蔽物理地址的差异。</code></li> <li>什么是域名解析<br> <code>DNS 协议提供通过域名查找 IP 地址，或逆向从 IP 地址反查域名的服务。DNS 是一个网络服务器，我们的域名解析简单来说就是在 DNS 上记录一条信息记录。</code></li> <li>浏览器如何通过域名去查询 URL 对应的 IP 呢？<br> <code>DNS域名解析分为递归查询和迭代查询两种方式，现一般为迭代查询</code></li></ol> <p><strong>DNS的优化与应用</strong></p> <ol><li>DNS 缓存<br> <code>DNS存在着多级缓存，从离浏览器的距离排序的话，有以下几种: 浏览器缓存，系统缓存，路由器缓存，IPS服务器缓存，根域名服务器缓存，顶级域名服务器缓存，主域名服务器缓存。</code></li> <li>DNS 负载均衡<br> <code>(DNS重定向) DNS负载均衡技术的实现原理是在DNS服务器中为同一个主机名配置多个IP地址，在应答DNS查询时， DNS服务器对每个查询将以DNS文件中主机记录的IP地址按顺序返回不同的解析结果，将客户端的访问 引导到不同的机器上去，使得不同的客户端访问不同的服务器，从而达到负载均衡的目的。</code></li></ol> <ul><li>大家耳熟能详的CDN(Content Delivery Network)就是利用DNS的重定向技术，DNS服务器会返回一个跟 用户最接近的点的IP地址给用户，CDN节点的服务器负责响应用户的请求，提供所需的内容。</li></ul> <ol start="3"><li>dns-prefetch DNS Prefetch 是一种 DNS 预解析技术<br> <code>当你浏览网页时，浏览器会在加载网页时对网页中的域名进行解析缓存，这样在你单击当前网页中的连接时就无需进行 DNS 的解析，减少用户等待时间，提高用户体验。</code></li></ol> <p><strong>依次解析顺序：浏览器缓存 -&gt; 系统缓存 -&gt; 路由缓存 -&gt; IPS 服务器缓存 -&gt; 根域名服务器缓存 -&gt; 顶级域名服务器缓存 -&gt; 主域名服务器缓存</strong> <img src="/doc/assets/img/dns.991c8101.png" alt="流程"></p> <p>小结：DNS 解析获得对应的 IP 地址，然后返回给浏览器，浏览器再将 IP 地址打在协议上，同时请求参数也会在协议搭载，然后一并发送给对应的服务器。接下来介绍向服务器发送 HTTP 请求阶段，HTTP 请求分为三个部分：TCP 三次握手、http 请求响应信息、关闭 TCP 连接。</p> <p><img src="/doc/assets/img/send.7c58d7dc.png" alt="流程"></p> <h3 id="_2、tcp链接"><a href="#_2、tcp链接" class="header-anchor">#</a> 2、TCP链接</h3> <p>在客户端发送数据之前会发起 TCP 三次握手以同步客户端和服务端的序列号、确认号，并交互 TCP 窗口大小信息</p> <p><img src="/doc/assets/img/handle.955df57e.jpg" alt="tcp 单词握手"></p> <p><strong>TCP 三次握手过程</strong></p> <ul><li>客户端发送一个 SYN=1, Seq=x 的数据包到服务端</li> <li>服务端发回一个 SYN=1, ACK=x+1, Seq=Y 的响应包以示确认信息</li> <li>客户端回传一个 ACK=Y+1, Seq=Z 的数据包到服务器，表示握手结束</li></ul> <p>为什么需要三次握手 ？<br> <strong>为了防止已失效的请求连接的请求报文又发送到服务器，因此产生错误</strong></p> <h3 id="_3、发送-http-请求"><a href="#_3、发送-http-请求" class="header-anchor">#</a> 3、发送 HTTP 请求</h3> <p>TCP 三次握手后发送 HTTP 请求报文。
HTTP 请求报文由请求行、请求头、请求体组成<br> <img src="/doc/assets/img/http.9ec0eb30.jpg" alt="HTTP 请求报文"></p> <ol><li>请求行包含请求方法、url、协议版本</li></ol> <ul><li>请求方法包含 8 种：GET、POST、PUT、DELETE、PATCH、HEAD、OPTIONS、TRACE</li> <li>URL 即请求地址，由 &lt;协议&gt;：//&lt;主机&gt;：&lt;端口&gt;/&lt;路径&gt;?&lt;参数&gt; 组成</li> <li>协议版本即 http 版本号
<code>POST /chapter17/user.html HTTP/1.1</code></li></ul> <ol start="2"><li>请求头包含请求的附加信息，由关键字/值对组成，每行一对，关键字和值用英文冒号“:”分隔</li></ol> <p>请求头部通知服务器有关于客户端请求的信息。它包含许多有关的客户端环境和请求正文的有用信息。其中比如：Host，表示主机名，虚拟主机；Connection,HTTP/1.1 增加的，使用 keepalive，即持久连接，一个连接可以发多个请求；User-Agent，请求发出者，兼容性以及定制化需求</p> <ol start="3"><li>请求体，可以承载多个请求参数的数据，包含回车符、换行符和请求数据，并不是所有请求都具有请求数据</li></ol> <h3 id="_4、服务器处理请求并返回请求报文"><a href="#_4、服务器处理请求并返回请求报文" class="header-anchor">#</a> 4、服务器处理请求并返回请求报文</h3> <p>详细内容暂略~</p> <ul><li>响应报文
响应报文由响应行、响应头、响应体组成<br> <img src="/doc/assets/img/res.8eb35d28.jpg" alt="HTTP 响应报文"></li></ul> <ol><li>响应行包含：协议版本，状态码，状态码描述</li></ol> <ul><li>1xx：指示信息--表示请求已接收，继续处理。</li> <li>2xx：成功--表示请求已被成功接收、理解、接受。</li> <li>3xx：重定向--要完成请求必须进行更进一步的操作。</li> <li>4xx：客户端错误--请求有语法错误或请求无法实现。</li> <li>5xx：服务器端错误--服务器未能实现合法的请求。</li></ul> <ol start="2"><li>响应头部包含响应报文的附加信息，由 名/值 对组成</li> <li>响应主体包含回车符、换行符和响应返回数据，并不是所有响应报文都有响应数据</li></ol> <h3 id="_5、浏览器解析渲染页面"><a href="#_5、浏览器解析渲染页面" class="header-anchor">#</a> 5、浏览器解析渲染页面</h3> <p>浏览器拿到响应的 HTML 后解析渲染页面<br> <img src="/doc/assets/img/html.a7be58e7.jpg" alt="html 解析渲染"></p> <p>大致分为以下几个过程：</p> <ul><li>根据 html 解析生成 DOM 树</li> <li>根据 css 解析生成 CSS 规则树</li> <li>结合 DOM 树和 CSS 规则树渲染 render 树</li> <li>根据 render 树计算每个节点的信息</li> <li>根据计算的节点信息进行页面绘制</li></ul> <p><strong>1、根据 HTML 解析 DOM 树</strong></p> <ul><li>DOM 树的解析过程是 深度遍历优先，先解析当前节点的子节点再解析兄弟节点</li> <li>解析 DOM 树的过程中如遇到 <code>script</code> 标签且没有 <code>async</code> <code>defer</code> 属性 则停止 DOM 树的解析直到 js 执行完毕</li></ul> <p><strong>2、根据 CSS 生成 CSS 规则树</strong></p> <ul><li>解析 CSS 规则树时暂停 js 的执行，知道 CSS 规则树解析完毕</li> <li>浏览器在 CSS 规则树生成之前是不会进行渲染</li></ul> <p><strong>3、结合 DOM 树和 CSS 规则树</strong></p> <ul><li>DOM 树和 CSS 规则树全部准备好了以后，浏览器才会开始构建渲染树</li> <li>精简 CSS 可以加快 CSS 规则树的构建，从而加快页面相应速度</li></ul> <p><strong>4、根据渲染树计算每一个节点的信息（布局）</strong></p> <ul><li>布局：通过渲染树中渲染对象的信息，计算出每一个渲染对象的位置和尺寸</li> <li>回流：在布局完成后，发现了某个部分发生了变化影响了布局，那就需要倒回去重新渲染。</li></ul> <p><strong>5、根据计算好的信息绘制页面</strong></p> <ul><li>绘制阶段，系统会遍历呈现树，并调用呈现器的“paint”方法，将呈现器的内容显示在屏幕上</li> <li>重绘：某个元素的背景颜色，文字颜色等，不影响元素周围或内部布局的属性，将只会引起浏览器的重绘</li> <li>回流：某个元素的尺寸发生了变化，则需重新计算渲染树，重新渲染</li></ul> <h3 id="_6、断开链接"><a href="#_6、断开链接" class="header-anchor">#</a> 6、断开链接</h3> <p>当数据传输完毕后需要断开 TCP 链接，此时发起 TCP 四次挥手</p> <p><img src="/doc/assets/img/close.1f747cf3.png" alt="四次挥手"></p> <ul><li>发起方 向 被动方发送报文，Fin、Ack、Seq，表示已经没有数据传输了。并进入 FIN_WAIT_1 状态（嗨，我要走了）</li> <li>被动方发送报文，Ack、Seq，表示同意关闭请求，此时发起方主机进入 FIN_WAIT_2 状态（好的，准了）</li> <li>被动发 向 发起发发送报文、Fin、Seq、Ack，请求关闭连接，并进入 LAST_ACK 状态（我也要走啦！）</li> <li>发送方 向 被动方发送报文，Ack、Seq，并进入 TIME_WAIT 状态。被动发收到发送方的报文后，关闭连接。发起方等待一段时间未收到回复，则正常关闭。（好的，我也批准了……怎么一直没回音？好吧，那我真的走了。）</li></ul> <p>参考文档：<br> <a href="https://github.com/kaola-fed/blog/issues/271" target="_blank" rel="noopener noreferrer">从输入页面地址到展示页面信息都发生了些什么？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://juejin.im/post/5c7646f26fb9a049fd108380#comment" target="_blank" rel="noopener noreferrer">从URL输入到页面展现到底发生什么？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020-03-11 16:49</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/doc/assets/js/app.914d0180.js" defer></script><script src="/doc/assets/js/2.1cb9a3c0.js" defer></script><script src="/doc/assets/js/4.69046a5f.js" defer></script>
  </body>
</html>
